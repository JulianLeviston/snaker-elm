# Codebase Structure

**Analysis Date:** 2026-01-30

## Directory Layout

```
snaker-elm/
├── assets/                 # Asset compilation and frontend code
│   ├── elm/               # Elm source files (client-side game logic)
│   ├── js/                # JavaScript entry and utilities
│   ├── css/               # Stylesheets
│   ├── static/            # Static files (copied to priv/static)
│   ├── node_modules/      # npm dependencies
│   ├── brunch-config.js   # Asset build configuration
│   └── package.json       # npm dependencies
├── lib/                   # Elixir application code
│   ├── snaker/           # Core application modules
│   │   ├── application.ex  # OTP supervision tree
│   │   ├── worker.ex       # GenServer for player state management
│   │   └── repo.ex         # Database config (disabled)
│   └── snaker_web/       # Phoenix web layer
│       ├── channels/     # WebSocket channel handlers
│       ├── controllers/  # HTTP request handlers
│       ├── views/        # View modules and templates
│       ├── templates/    # EEx HTML templates
│       ├── router.ex     # Route definitions
│       ├── endpoint.ex   # Phoenix endpoint config
│       └── gettext.ex    # Internationalization
├── priv/                 # Private/generated assets
│   ├── static/          # Compiled assets (CSS, JS)
│   └── repo/            # Database migrations (unused)
├── test/                # Test files
├── config/              # Environment configuration
├── deps/                # Phoenix dependencies (mix dependencies)
├── _build/              # Build artifacts
├── mix.exs              # Elixir project configuration
├── mix.lock             # Dependency lock file
└── README.md            # Project documentation
```

## Directory Purposes

**assets/elm/:**
- Purpose: Elm source code (0.18) for client-side game
- Contains: Main.elm, Data modules (models), Board.Html (rendering)
- Key files: `Main.elm` (entry point), `Board/Html.elm` (UI)
- Substructure:
  - `elm/` - Root Elm files
  - `elm/Data/` - Data models and game logic
  - `elm/Board/` - Board-specific rendering
  - `elm/elm-stuff/` - Elm package cache (generated)

**assets/js/:**
- Purpose: JavaScript glue code for Elm and Phoenix interop
- Contains: `app.js` (main entry, Elm initialization)
- Key files: `assets/js/app.js` - Embeds Elm app in DOM, imports Phoenix HTML

**assets/css/:**
- Purpose: Application stylesheets
- Contains: Global styles for layout and board display

**lib/snaker/:**
- Purpose: Core Elixir application logic
- Key files: `worker.ex` - Player state management via GenServer

**lib/snaker_web/:**
- Purpose: Phoenix web layer (HTTP and WebSocket)
- Substructure:
  - `channels/` - WebSocket channel logic
  - `controllers/` - HTTP request handlers
  - `views/` - View logic
  - `templates/` - EEx HTML templates
- Key files:
  - `channels/game_channel.ex` - Game event coordination
  - `channels/user_socket.ex` - WebSocket connect handler
  - `router.ex` - Route definitions
  - `controllers/page_controller.ex` - Index page handler
  - `templates/layout/app.html.eex` - Main HTML layout
  - `templates/page/index.html.eex` - Game page (Elm mount point)

**priv/static/:**
- Purpose: Public assets served to browser
- Contains: Compiled CSS, JavaScript, images
- Generated by: Brunch build process from assets/

**config/:**
- Purpose: Environment-specific configuration
- Key files: `config.exs` (dev), `prod.exs` (production)

**test/:**
- Purpose: Test files (minimal in current codebase)
- Organization: Test support files and test cases

## Key File Locations

**Entry Points:**

- `assets/elm/Main.elm` - Elm application entry point (Html.program)
- `lib/snaker_web/router.ex` - HTTP route definitions
- `lib/snaker_web/channels/user_socket.ex` - WebSocket entry point

**Configuration:**

- `mix.exs` - Elixir project and dependency configuration
- `assets/elm/elm-package.json` - Elm dependency manifest
- `assets/package.json` - JavaScript dependencies
- `assets/brunch-config.js` - Asset build pipeline configuration
- `config/config.exs` - Phoenix environment configuration

**Core Game Logic:**

- `assets/elm/Data/Board.elm` - Board state and main update logic
- `assets/elm/Data/Snake.elm` - Snake entity and movement logic
- `assets/elm/Data/Player.elm` - Player identity and serialization
- `assets/elm/Data/Apple.elm` - Apple spawning and expiration
- `assets/elm/Data/Direction.elm` - Direction type and conversions
- `assets/elm/Data/Position.elm` - Board coordinates and grid

**Frontend Rendering:**

- `assets/elm/Board/Html.elm` - Game board HTML rendering
- `lib/snaker_web/templates/page/index.html.eex` - Elm mount point
- `lib/snaker_web/templates/layout/app.html.eex` - HTML layout

**Backend Coordination:**

- `lib/snaker_web/channels/game_channel.ex` - Game event broadcasting
- `lib/snaker_web/channels/user_socket.ex` - Player creation on connect
- `lib/snaker/worker.ex` - Player registry GenServer

**Assets Pipeline:**

- `assets/js/app.js` - JavaScript entry point
- `assets/brunch-config.js` - Brunch configuration for Elm compilation

## Naming Conventions

**Files:**

- Elm modules: `PascalCase.elm` (e.g., `Main.elm`, `Board.elm`, `Snake.elm`)
- Elixir modules: `snake_case.ex` or `PascalCase.ex` (e.g., `game_channel.ex`)
- Data modules: `PascalCase.elm` in `Data/` subdirectory (e.g., `Data/Board.elm`)

**Directories:**

- Elm packages: Grouped by concern (e.g., `Data/` for data models)
- Phoenix web modules: Grouped by type (e.g., `channels/`, `controllers/`, `views/`)
- Assets: Grouped by type (e.g., `js/`, `css/`, `elm/`)

**Module Names:**

- Elm: Full module path includes directory (e.g., `module Data.Board`)
- Elixir: Namespace via directory structure (e.g., `SnakerWeb.GameChannel`)

## Where to Add New Code

**New Feature (Game Mechanic):**
- Primary code: `assets/elm/Data/` - Add new data module or extend Board.elm
- Board update: Modify `Board.update` to handle new message type
- Rendering: Update `Board/Html.elm` to display new feature
- Example: Adding bomb collectibles would go in `Data/Bomb.elm`, extended in Board

**New UI Component:**
- Implementation: `assets/elm/Board/Html.elm` - Extend view function
- Styling: `assets/css/app.css` - Add CSS for new component
- Example: New score display or player list

**New Backend Event:**
- Channel handler: `lib/snaker_web/channels/game_channel.ex` - Add handle_in/3 clause
- Broadcast coordination: Add broadcast!/3 call to notify all clients
- Frontend receiver: `Main.elm` - Add Socket.on subscription in init
- Frontend processor: Add ServerMsg variant and updateFromServer clause

**New Server State:**
- GenServer operation: `lib/snaker/worker.ex` - Add handle_call or handle_cast
- Access method: Export new function from Worker module
- Usage: Call from GameChannel or initialization

**Utilities:**
- Shared helpers: `assets/elm/Data/` - New module for pure functions
- Elixir helpers: `lib/snaker/` - New module for business logic
- Avoid creating in channels/controllers (keep those thin)

## Special Directories

**assets/elm/elm-stuff/:**
- Purpose: Elm package cache and compiled dependencies
- Generated: Yes (created by elm-package install)
- Committed: No (in .gitignore)

**priv/static/:**
- Purpose: Public compiled assets
- Generated: Yes (created by Brunch build)
- Committed: No (in .gitignore)

**_build/:**
- Purpose: Elixir build artifacts
- Generated: Yes (created by mix compile)
- Committed: No (in .gitignore)

**deps/:**
- Purpose: Phoenix and Elixir dependencies
- Generated: Yes (created by mix deps.get)
- Committed: No (in .gitignore)

**node_modules/:**
- Purpose: npm dependencies (Brunch, npm packages)
- Generated: Yes (created by npm install)
- Committed: No (in .gitignore)

## Project Structure Patterns

**Module Exports:**
- Elm: Explicit `exposing` lists control public API (see `Main.elm`, `Data.Board`)
- Elixir: Modules are public by default; functions prefixed with `_` are private conventions

**Message Types:**
- Board messages: `Board.Msg` (public), `ServerMsg` (private to Main)
- Phoenix messages: `PhoenixMsg` wraps `Socket.Msg` for type safety

**Code Organization Principles:**
1. Data models isolated in `Data/` directory
2. Rendering isolated in `Board/Html.elm`
3. Main coordination in `Main.elm` (subscriptions, routing)
4. Backend channels keep event broadcast logic; Worker keeps state
5. No business logic in controllers/views (thin web layer)

---

*Structure analysis: 2026-01-30*
