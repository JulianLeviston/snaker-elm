---
phase: 03-integration-sync
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - assets/src/View/Board.elm
  - assets/src/Snake.elm
  - assets/src/Main.elm
autonomous: true

must_haves:
  truths:
    - "Game board renders as SVG with correct grid dimensions"
    - "Snakes render as circles with distinct head styling"
    - "Apples render with emoji/icon appearance"
    - "Player's own snake has glow effect"
  artifacts:
    - path: "assets/src/View/Board.elm"
      provides: "SVG game board rendering"
      exports: ["view"]
      min_lines: 80
    - path: "assets/src/Snake.elm"
      provides: "Enhanced snake types with is_invincible, name, state"
      contains: "isInvincible"
    - path: "assets/src/Main.elm"
      provides: "Updated view using Board module"
      contains: "Board.view"
  key_links:
    - from: "assets/src/View/Board.elm"
      to: "assets/src/Snake.elm"
      via: "import Snake"
      pattern: "Snake\\.Snake"
    - from: "assets/src/Main.elm"
      to: "assets/src/View/Board.elm"
      via: "import Board"
      pattern: "Board\\.view"
---

<objective>
Create SVG game board rendering with snakes, apples, and visual indicators.

Purpose: Players need to SEE the game to play it. The current UI just shows text counts. This plan implements the visual game board that renders server state.

Output: View/Board.elm module with SVG rendering, updated Snake type with new fields, Main.elm using Board.view.
</objective>

<execution_context>
@/Users/julian/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julian/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-integration-sync/03-RESEARCH.md

@assets/src/Main.elm
@assets/src/Game.elm
@assets/src/Snake.elm
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Snake module with new fields and head helper</name>
  <files>assets/src/Snake.elm</files>
  <action>
Extend the Snake type and decoder:

1. Add new fields to Snake type alias:
   - `name : String`
   - `isInvincible : Bool`
   - `state : String` — "alive" or "dying"

2. Update decoder to decode these fields from JSON:
   - `name` from "name" (JD.string)
   - `isInvincible` from "is_invincible" (JD.bool)
   - `state` from "state" (JD.string, default to "alive" if missing for backwards compat)

3. Add helper function `head : Snake -> Maybe Position` that returns first element of body list (the head position).

4. Export the new fields and head function.

Use JD.map7 or JD.succeed with JD.andThen pipeline for 7-field decoder.
  </action>
  <verify>
Run `cd assets && npm run build` — Elm compiles without errors. The decoder handles all snake fields.
  </verify>
  <done>
Snake type includes name, isInvincible, state fields. Decoder parses all fields from server JSON. head helper function exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create View/Board.elm SVG rendering module</name>
  <files>assets/src/View/Board.elm</files>
  <action>
Create new module at assets/src/View/Board.elm:

```elm
module View.Board exposing (view)
```

Implement SVG game board rendering:

1. **Constants:**
   - `cellSize = 20` (pixels per grid cell)

2. **Main view function:**
   ```elm
   view : GameState -> Maybe String -> Html msg
   view gameState maybePlayerId
   ```
   - Takes game state and current player ID (for "you" highlighting)
   - Returns SVG element with viewBox matching grid dimensions

3. **Snake rendering:**
   - Use Html.Keyed.node "g" for snake list (key by snake.id)
   - Each snake is a group with CSS classes: "snake", conditionally "invincible", "dying", "you"
   - Body segments: Svg.circle at each position
   - Head (first segment): Larger circle or different fill, eyes as two small circles
   - Position formula: `x * cellSize + cellSize // 2` (center of cell)
   - Radius: `cellSize // 2 - 2` for body, slightly larger for head

4. **Apple rendering:**
   - Svg.text_ element with apple emoji or Svg.circle with red fill
   - Position at center of cell

5. **Render order** (SVG has no z-index, order matters):
   - Background rect (optional, light color)
   - Apples first
   - Snakes second (so heads appear on top of apples)

6. **CSS class application:**
   - `classList [ ("snake", True), ("invincible", snake.isInvincible), ("dying", snake.state == "dying"), ("you", Just snake.id == maybePlayerId) ]`

Import Html.Keyed for optimized list rendering. Import Svg and Svg.Attributes.
  </action>
  <verify>
Run `cd assets && npm run build` — Elm compiles without errors. View/Board.elm exports view function.
  </verify>
  <done>
View/Board.elm renders SVG game board with snakes (keyed, CSS classes for effects), apples, and player highlight.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate Board.view into Main.elm</name>
  <files>assets/src/Main.elm</files>
  <action>
Update Main.elm to use the new Board rendering:

1. Add import: `import View.Board as Board`

2. Update Model to store player ID:
   - Change `playerId : Maybe String` handling in GotGameState or add from join response
   - The join response includes player data — extract ID from PlayerJoined event

3. Update view function:
   - Replace the text-based state display with Board.view
   - Pass gameState and model.playerId to Board.view
   - Keep status text above the board
   - Structure:
     ```elm
     div [ class "game-container" ]
         [ div [ class "game-header" ] [ status info ]
         , case model.gameState of
             Just state -> Board.view state model.playerId
             Nothing -> div [] [ text "Loading..." ]
         ]
     ```

4. Handle PlayerJoined to extract own player ID:
   - Decode the player object from the event
   - Store player.id in model.playerId

Remove Debug.log statements from update function (no longer needed for production).
  </action>
  <verify>
Run `cd assets && npm run build` — compiles without errors. Run `mix phx.server`, open browser at localhost:4000, see SVG game board with snakes and apples rendered.
  </verify>
  <done>
Main.elm uses Board.view to render game. Player ID extracted from join event. SVG game board visible in browser.
  </done>
</task>

</tasks>

<verification>
1. `cd assets && npm run build` compiles all Elm without errors
2. `mix phx.server` starts and serves the page
3. Browser shows SVG game board (not just text)
4. At least one snake visible with colored circles
5. Apples visible on the board
6. Arrow keys still change direction (existing functionality preserved)
</verification>

<success_criteria>
- SVG game board renders with correct dimensions
- Snakes render as colored circles with distinct heads
- Apples render visually (emoji or colored circle)
- Player's own snake has "you" CSS class applied
- Invincible snakes have "invincible" CSS class applied
- Elm compiles and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-sync/03-02-SUMMARY.md`
</output>
