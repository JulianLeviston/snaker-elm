---
phase: 03-integration-sync
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/snaker/game_server.ex
  - assets/css/app.css
autonomous: true

must_haves:
  truths:
    - "Snake JSON includes is_invincible boolean"
    - "Snake JSON includes name string"
    - "CSS animations exist for invincibility flash, death fade, and you-glow"
  artifacts:
    - path: "lib/snaker/game_server.ex"
      provides: "Enhanced snake serialization"
      contains: "is_invincible"
    - path: "assets/css/app.css"
      provides: "Visual effect animations"
      contains: "@keyframes"
  key_links:
    - from: "lib/snaker/game_server.ex"
      to: "Elm Snake decoder"
      via: "JSON field names"
      pattern: "is_invincible.*name"
---

<objective>
Add backend fields and CSS animations needed for Phase 3 visual rendering.

Purpose: Server must send invincibility state and player name for Elm to render correctly. CSS animations provide visual feedback for game events without Elm state complexity.

Output: Enhanced snake serialization and CSS keyframe animations for flash/fade/glow effects.
</objective>

<execution_context>
@/Users/julian/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julian/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-integration-sync/03-RESEARCH.md

@lib/snaker/game_server.ex
@lib/snaker/game/snake.ex
@assets/css/app.css
@assets/src/Snake.elm
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance snake serialization with is_invincible and state</name>
  <files>lib/snaker/game_server.ex, lib/snaker/game/snake.ex</files>
  <action>
Update serialize_snake/1 in GameServer to include:
- `is_invincible: Snake.is_invincible?(snake)` — boolean for client to show flash effect
- `name: snake.name` — already exists in snake struct, just needs serialization
- `state: "alive" | "dying"` — for death animation (set "alive" for now, death handling in later plan)

In Snake module, ensure is_invincible?/1 is public and works correctly (it already exists).

The Elm Snake decoder will need updating in the next plan to decode these fields. For now, just ensure the server sends them.

Test by checking GameServer.get_full_state/0 output includes new fields.
  </action>
  <verify>
Run in iex: `Snaker.GameServer.get_full_state()` and confirm each snake in the response has `is_invincible`, `name`, and `state` fields.
  </verify>
  <done>
Snake JSON serialization includes is_invincible (boolean), name (string), and state ("alive"/"dying") fields.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add CSS animations for visual effects</name>
  <files>assets/css/app.css</files>
  <action>
Add CSS keyframe animations and classes for game visual effects:

1. **Invincibility flash** — `.snake.invincible` with 200ms flash cycle between opacity 1 and 0.3

2. **Death fade-out** — `.snake.dying` with 500ms fadeOut animation (opacity 1 to 0, forwards fill)

3. **"You" indicator glow** — `.snake.you circle` with drop-shadow filter (double glow at 8px and 12px using currentColor)

4. **Toast notification** — `.toast` with fixed position top-right, slideInFadeOut animation (3s total: slide in, hold, fade out)

5. **Scoreboard styling** — `.scoreboard` with basic layout, `.player-entry` with color dot and name/score

Use patterns from 03-RESEARCH.md code examples. Keep CSS minimal and focused on the animations themselves — layout details can be adjusted later.
  </action>
  <verify>
Run `npm run build` in assets/ directory and confirm no CSS syntax errors. Visually inspect app.css contains @keyframes for flash, fadeOut, slideInFadeOut.
  </verify>
  <done>
app.css contains working CSS animations: invincibility flash, death fade, you-glow, toast slideInFadeOut, and scoreboard base styles.
  </done>
</task>

</tasks>

<verification>
1. `mix phx.server` starts without errors
2. `Snaker.GameServer.get_full_state()` in iex shows is_invincible, name, state fields per snake
3. `cd assets && npm run build` compiles CSS without errors
4. app.css contains @keyframes flash, @keyframes fadeOut, @keyframes slideInFadeOut
</verification>

<success_criteria>
- Snake serialization includes is_invincible (boolean), name (string), state (string)
- CSS file contains all required keyframe animations
- Both backend and frontend asset builds pass without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-sync/03-01-SUMMARY.md`
</output>
